$rootPath {
	handle $botPath {
		reverse_proxy http://localhost:$botPort
	}

	basicauth /db* {
		admin $2a$14$66WLZF59VjkP6YR4ef1uyOhM2vjooBVodcD5PhqS5QuQfAVjzZAyK
	}

	encode gzip

	@websockets {
		header Connection *Upgrade*
		header Upgrade websocket
	}

	# Handle WebSocket connections
	reverse_proxy @websockets http://localhost:$webappPort {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Port {server_port}
		header_up X-Forwarded-Proto {scheme}
		header_up Connection {http.request.header.Connection}
		header_up Upgrade {http.request.header.Upgrade}
	}

	# Handle regular HTTP connections
	reverse_proxy http://localhost:$webappPort {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Port {server_port}
		header_up X-Forwarded-Proto {scheme}
	}
}
